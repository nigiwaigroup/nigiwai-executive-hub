<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Nigiwai Executive Hub</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="login-logo">üîê</div>
                <h1>Nigiwai Executive Hub</h1>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ PIN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
            </div>

            <form class="login-form" id="login-form">
                <div class="input-group">
                    <label for="pin-input">PIN Code</label>
                    <input 
                        type="password" 
                        id="pin-input" 
                        maxlength="4" 
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        autocomplete="off"
                        required
                    >
                    <i class="fas fa-eye toggle-pin" id="toggle-pin"></i>
                </div>

                <div class="error-message" id="error-message">
                    <i class="fas fa-exclamation-circle"></i>
                    ‡∏£‡∏´‡∏±‡∏™ PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </div>

                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i>
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>

            <div class="text-center mt-3" style="font-size: 0.85rem; color: #9ca3af;">
                <i class="fas fa-shield-alt"></i>
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£
            </div>
        </div>
    </div>

    <script>
        // ‡∏£‡∏∞‡∏ö‡∏ö Authentication ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ (Inline)
        const CORRECT_PIN = '8787';
        const STORAGE_KEY = 'nigiwai_auth_session';
        const SESSION_TIMEOUT = 480; // 8 hours in minutes

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage
        function isLocalStorageAvailable() {
            try {
                const test = '__test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch(e) {
                return false;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Authentication
        function isAuthenticated() {
            if (!isLocalStorageAvailable()) return false;

            const sessionData = localStorage.getItem(STORAGE_KEY);
            if (!sessionData) return false;

            try {
                const session = JSON.parse(sessionData);
                const now = new Date().getTime();
                const sessionAge = (now - session.loginTime) / (1000 * 60); // minutes

                if (sessionAge > SESSION_TIMEOUT) {
                    localStorage.removeItem(STORAGE_KEY);
                    return false;
                }

                return true;
            } catch(e) {
                return false;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Login
        function login(pin) {
            if (pin === CORRECT_PIN) {
                const session = {
                    authenticated: true,
                    loginTime: new Date().getTime(),
                    lastActivity: new Date().getTime()
                };
                
                if (isLocalStorageAvailable()) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(session));
                }
                return true;
            }
            return false;
        }

        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', () => {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Login ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            if (isAuthenticated()) {
                window.location.href = 'dashboard.html';
                return;
            }

            // ‡∏î‡∏∂‡∏á Elements
            const togglePin = document.getElementById('toggle-pin');
            const pinInput = document.getElementById('pin-input');
            const loginForm = document.getElementById('login-form');
            const errorMessage = document.getElementById('error-message');

            // Toggle PIN Visibility
            if (togglePin && pinInput) {
                togglePin.addEventListener('click', () => {
                    if (pinInput.type === 'password') {
                        pinInput.type = 'text';
                        togglePin.classList.remove('fa-eye');
                        togglePin.classList.add('fa-eye-slash');
                    } else {
                        pinInput.type = 'password';
                        togglePin.classList.remove('fa-eye-slash');
                        togglePin.classList.add('fa-eye');
                    }
                });
            }

            // Handle Login Form Submit
            if (loginForm && pinInput && errorMessage) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();

                    const pin = pinInput.value.trim();
                    
                    console.log('Attempting login with PIN:', pin); // Debug

                    if (login(pin)) {
                        // Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                        console.log('Login successful!'); // Debug
                        window.location.href = 'dashboard.html';
                    } else {
                        // Login ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                        console.log('Login failed!'); // Debug
                        errorMessage.classList.add('show');
                        pinInput.value = '';
                        pinInput.focus();

                        setTimeout(() => {
                            errorMessage.classList.remove('show');
                        }, 3000);
                    }
                });
            }

            // Auto-focus PIN input
            if (pinInput) {
                pinInput.focus();

                // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ Paste
                pinInput.addEventListener('paste', (e) => {
                    e.preventDefault();
                });

                // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                pinInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                });
            }
        });
    </script>
</body>
</html>
